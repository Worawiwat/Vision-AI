<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width,initial-scale=1" name="viewport">
  <meta content="description" name="description">
  <meta name="google" content="notranslate" />
  <meta name="msapplication-tap-highlight" content="no">
  <link rel="apple-touch-icon" sizes="180x180" href="./assets/apple-icon-180x180.png">
  <link href="./assets/favicon.ico" rel="icon">

  <title>Image Segmentation</title></title>

  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <link href="./main.3f6952e4.css" rel="stylesheet">
  <style>
    #webcam-container {
      text-align: center;
      margin-top: 20px;
    }

    .frame {
      width: 400px;
      height: 300px;
      border: 2px solid #333;
      display: inline-block;
      position: relative;
      overflow: hidden;
      margin-bottom: 10px;
    }

    #webcam {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .center-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    
    #segmentation-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .center-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 10vh;
    }

    button {
      margin: 10px;
    }

    #webcamButton {
      background-color: #6200ea;
      color: white;
      padding: 5px 5px;
      font-size: 10px;
      border: none;
      cursor: pointer;
      display: block;
      margin-top: 1px;
      margin-left: auto;
      margin-right: auto;
    }

    #webcamButton:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }

    #webcam-container {
      text-align: center;
    }

    .frame {
      position: relative;
      width: 400px;
      height: 300px;
      border: 2px solid #333;
      display: inline-block;
      margin-bottom: 10px;
    }
  </style>
</head>

<body class="">
  <div id="site-border-left"></div>
  <div id="site-border-right"></div>
  <div id="site-border-top"></div>
  <div id="site-border-bottom"></div>

  <header>
    <nav class="navbar  navbar-fixed-top navbar-default">
      <div class="container">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbar-collapse">
          <ul class="nav navbar-nav ">
            <li><a href="./index.html" title="">Home</a></li>
            <li><a href="./ImageClassification.html" title="">ImageClassification</a></li>
            <li><a href="./ObjectDetection.html" title="">ObjectDetection</a></li>
            <li><a href="./ImageSegmentation.html" title="">ImageSegmentation</a></li>
            <li><a href="./HandLandmarkDetection.html" title="">HandLandmarkDetection</a></li>
            <li><a href="./FaceDetection.html" title="">FaceDetection</a></li>
            <li><a href="./aboutus.html" title="">About us</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <div class="section-container">
    <div class="container center-container">
      <div class="row">
        <div class="col-sm-8 col-sm-offset-2 section-container-spacer">
          <div class="text-center">
            <h1 class="h2">Image Segmentation</h1>
            <p>Image Segmentation คือกระบวนการในงานประมวลผลภาพที่แบ่งภาพออกเป็นส่วนย่อย ๆ โดยแต่ละส่วนจะประกอบด้วยพิกเซลที่มีคุณลักษณะคล้ายกัน เช่น สี, ความเข้ม, หรือรูปทรง เป้าหมายของ Image Segmentation คือการระบุวัตถุหรือขอบเขตเฉพาะของวัตถุในภาพ และแยกพวกมันออกจากกันหรือจากพื้นหลัง            </p>
          </div>
        </div>
      </div>

<!-- Webcam Container -->
<div id="webcam-container">
  <h3>Real-time Image Segmentation</h1>
  <div class="frame">
    <video id="webcam" autoplay playsinline></video>
    <canvas id="segmentation-canvas"></canvas>
  </div>
  <button id="webcamButton">ENABLE SEGMENTATION</button>
</div>

    </div>
  </div>

  <script type="module">
    import {
      ImageSegmenter,
      FilesetResolver
    } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.2";
  
    let imageSegmenter;
    let webcamRunning = false;
    let video = document.getElementById('webcam');
    let canvas = document.getElementById('segmentation-canvas');
    let ctx = canvas.getContext('2d');
    let enableWebcamButton = document.getElementById('webcamButton');
  
    async function createImageSegmenter() {
      const vision = await FilesetResolver.forVisionTasks(
        "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.2/wasm"
      );
      imageSegmenter = await ImageSegmenter.createFromOptions(vision, {
        baseOptions: {
          modelAssetPath: 'https://storage.googleapis.com/mediapipe-models/image_segmenter/deeplab_v3/float32/1/deeplab_v3.tflite',
        },
        runningMode: "VIDEO", // This is for the webcam
        outputCategoryMask: true,
        outputConfidenceMasks: false
      });
    }
  
    // For Real-time segmentation (webcam)
    async function predictWebcam() {
      if (!webcamRunning) return;
  
      const startTimeMs = performance.now();
      const result = await imageSegmenter.segmentForVideo(video, startTimeMs);
  
      if (result.categoryMask) {
        const width = result.categoryMask.width;
        const height = result.categoryMask.height;
        const maskData = result.categoryMask.getAsUint8Array();
  
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
  
        const imageData = ctx.createImageData(width, height);
        const legendColor = [255, 0, 0, 100]; // Red with alpha
        for (let i = 0; i < maskData.length; i++) {
          const j = i * 4;
          if (maskData[i] > 0) {
            imageData.data[j] = legendColor[0];
            imageData.data[j + 1] = legendColor[1];
            imageData.data[j + 2] = legendColor[2];
            imageData.data[j + 3] = legendColor[3];
          }
        }
        ctx.putImageData(imageData, 0, 0);
      }
  
      requestAnimationFrame(predictWebcam);
    }
  
    async function enableCam() {
      if (!imageSegmenter) {
        await createImageSegmenter();
      }
  
      if (!webcamRunning) {
        enableWebcamButton.innerText = "DISABLE SEGMENTATION";
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        video.onloadeddata = () => {
          webcamRunning = true;
          predictWebcam();
        };
      } else {
        enableWebcamButton.innerText = "ENABLE SEGMENTATION";
        const tracks = video.srcObject.getTracks();
        tracks.forEach(track => track.stop());
        webcamRunning = false;
      }
    }
  
    enableWebcamButton.addEventListener('click', enableCam);
  </script>
  
  <footer class="footer-container text-center">
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <p>Website created by : Worawiwat Chaichuang , Rawinpat Boontanutsakul , Panupong Jantabootrah</p>
        </div>
      </div>
    </div>
  </footer>

  <script type="text/javascript" src="./main.70a66962.js"></script>
</body>

</html>
